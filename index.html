<!DOCTYPE html>
<html background-color="black">
<head>
    <meta charset="utf-8" />
    <title>Breakout!</title>
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
    <style>
      @import url('https://fonts.googleapis.com/css?family=Press+Start+2P');
    	* { padding-right: 0;
          padding-top:0;
          margin: 0;
          font-family: 'Press Start 2P';
          background-color: "black" }

    	canvas { background: #acbf9a;
               font-size: 18px;
               padding-right: 0px;
               padding-top: 0px;
             }

      body {
           background-image: url("http://wallpapercave.com/wp/xR46rwq.jpg");
           display:flex;
           justify-content: center;
           }

    </style>
</head>
<body>
<canvas id="myCanvas" width="850"  height="600"></canvas>

<script>
  const canvas = document.getElementById("myCanvas");
  const ctx = canvas.getContext("2d");

  let xball = canvas.width/2;
  let yball = canvas.height-30;
  let dx = 5;
  let dy = -5;
  const ballRadius = 8;

  const paddleHeight = 10;
  let paddleWidth = 100;
  let paddleX = (canvas.width-paddleWidth)/2;

  let rightPressed = false;
  let leftPressed = false;

  let blockRows = 1;
  let blockCols = 8;
  const blockWidth = 75;
  const blockHeight = 20;

  let score = 0;
  let lives = 3;
  let pause = false;
  let autoplay = false;
  let level = 1;

  let blocks = [];
  for(c=0; c < blockCols; c++) {
    blocks[c] = [];
    for(r=0; r<blockRows; r++) {
      blocks[c][r] = { x: 0, y: 0, destroyed: false};
    }
  }

  let blocksLeft = blocks.length;


  function createBlocks(){
    blocks = [];
    for(c=0; c < blockCols; c++) {
      blocks[c] = [];
      for(r=0; r<blockRows; r++) {
        blocks[c][r] = { x: 0, y: 0, destroyed: false};

      }
    }
    blocksLeft = blockRows * blockCols;
  }

  function drawBall() {
    ctx.beginPath();
    ctx.arc(xball, yball, 8, 0, Math.PI*2);
    ctx.fillStyle = "#526044";
    ctx.fill();
    ctx.closePath();
  }

  function drawPaddle() {
    ctx.beginPath();
    ctx.rect(paddleX, canvas.height-paddleHeight, paddleWidth, paddleHeight);
    ctx.fillStyle = "#526044";
    ctx.fill();
    ctx.closePath();
}

function drawBlocks() {
    for(c=0; c<blockCols; c++) {
      for(r=0; r<blockRows; r++) {
        if(blocks[c][r].destroyed == false) {
          let blockX = (c*(blockWidth + 1))+ 130;
          let blockY = (r*(blockHeight + 1))+ 80;
          blocks[c][r].x = blockX;
          blocks[c][r].y = blockY;

          ctx.beginPath();
          ctx.rect(blockX, blockY, blockWidth, blockHeight);
          ctx.fillStyle = "#748268";
          ctx.fill();
          ctx.closePath();
        }
    }
  }
}


  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBall();
    drawPaddle();
    drawBlocks();
    collisionCheck();
    drawBlocksLeft();
    drawLives();
    drawLevel();
    if(autoplay == false){
      drawWelcome();
    }

    xball += dx;
    yball += dy;

    if(rightPressed && paddleX < canvas.width-paddleWidth) {
    paddleX += 10;
    }
    else if(leftPressed && paddleX > 0) {
        paddleX -= 10;
    }

    if(xball + dx > canvas.width - ballRadius - 5 || xball + dx < 0) {
    dx = -dx;
    }

    if(yball + dy < ballRadius) {
    dy = -dy;
    } else if(yball + dy > canvas.height - ballRadius - 5) {
        if(xball > paddleX && xball < paddleX + paddleWidth) {
            dy = -dy;
         } else {
          lives -= 1;
            if(lives == 0) {
              drawGameOver();
              cancelAnimationFrame();
            } else {
              xball = canvas.width/2;
              yball = canvas.height-30;
              paddleX = (canvas.width-paddleWidth)/2;
          }
        }
    }


    if(pause == false && autoplay == true){
        if(blocksLeft == 0) {
          level += 1;
          blockRows += 1;
          dx += 2
          dy -= 2;
          lives += 1
          xball = canvas.width/2;
          yball = canvas.height-30;
          paddleX = (canvas.width-paddleWidth)/2;
          createBlocks();

        }
      requestAnimationFrame(draw);
     }
  }


  draw();
  document.addEventListener("keydown", keyDownHandler, false);
  document.addEventListener("keyup", keyUpHandler, false);


  function keyDownHandler(e) {
    // right arrow
    if(e.keyCode == 39) {
      rightPressed = true;
    }
    //left arrow
    else if(e.keyCode == 37) {
        leftPressed = true;
    }
    // P
    else if(e.keyCode == 80) {
      pause = !pause;
      draw();
    }
    // Enter
    else if(e.keyCode == 13){
      autoplay = !autoplay;
      draw();
    }
    // N
    else if(e.keyCode == 78){
      document.location.reload();
    }
  }

  function keyUpHandler(e) {
    if(e.keyCode == 39) {
        rightPressed = false;
    }
    else if(e.keyCode == 37) {
        leftPressed = false;
    }
  }

  function nextLevelCheck(){
    if(score == totalBlocks) {
      level += 1;
      blockRows += 1;
      dx += 2;
      dy -= 2;
      lives += 1;
      requestAnimationFrame(draw);
    }
  }


  function collisionCheck() {
  for(c=0; c < blockCols; c++) {
    for(r=0; r < blockRows; r++) {
      var b = blocks[c][r];
      if(b.destroyed == false || b.destroyed == "undefined") {
        if(xball > b.x && xball < b.x+blockWidth && yball > b.y && yball < b.y+blockHeight) {
          dy = -dy;
          b.hits += 1;
          b.destroyed = true;
          blocksLeft -= 1;
          }
        }
      }
    }
  }



function drawBlocksLeft() {
    ctx.font = "20px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("BLOCKS LEFT: "+ blocksLeft, 8, 30);
}

function drawLevel() {
    ctx.font = "20px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("LEVEL: "+ level, 8, 50);
}

function drawLives() {
    ctx.font = "20px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("LIVES: "+lives, canvas.width-115, 30);
}

function drawNextLevel(){
    ctx.font = "30px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("Great! ready for Level "+level+"? (press enter)", canvas.width/2 - 350, canvas.height/2);

}

function drawGameOver(){
    ctx.font = "30px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("Game Over \n(press N to start new game)", canvas.width/2 - 350, canvas.height/2);
}

function drawWelcome(){
    ctx.font = "30px Lucida Console";
    ctx.fillStyle = "#526044";
    ctx.fillText("BREAKOUT! PRESS ENTER TO START", canvas.width/2 - 270, canvas.height/2);
}

</script>

</body>
</html>
